---
title: "Mapa de calor (2D Density)"
subtitle: "Mapa de calor utilizando las incidencias delictivas a nivel municipal"
author: "Diana Villasana Ocampo"
knit: (function(inputFile, encoding) {
       rmarkdown::render(inputFile, encoding = encoding, output_dir = "../Output/")
  })
output:
   html_document:
      code_folding: hide
      highlight: tango
      theme: flatly
      toc: true
      toc_depth: 3
      toc_float:
        collapsed: yes
---

```{=html}
<style type="text/css">
body {
text-align: justify;
font-style: normal;
font-family: "Montserrat";
font-size: 12px
}
h1.title {
  font-size: 40px;
  color: #000D3B;
}
h1 {
  color: #B6854D;
}
h2 {
  color: #172984;
}
h3 {
  color: #172984;
}
</style>
```

```{=html}
<style>
.nav>li>a {
    position: relative;
    display: block;
    padding: 10px 15px;
    color: #1C3BA4
}
.nav-pills>li.active>a, .nav-pills>li.active>a:hover, .nav-pills>li>a:focus {
    color: #ffffff;
    background-color: #09C2BC
}
</style>
```

```{=html}
<style>
.tile1-text {
    position: relative;
    display: block;
    padding: 10px 15px;
    color: #0A6A87;
    list-style: none;
}
.top1-tiles a:nth-of-type(1):hover, .top-tiles1 a:nth-of-type(1):focus{
    color: #ffffff;
    background: #0A6A87
}
</style>
```

```{=html}
<style>
.tile2-text {
    position: relative;
    display: block;
    padding: 10px 15px;
    color: #0A6CC8;
    list-style: none;
}
.top2-tiles a:nth-of-type(1):hover, .top2-tiles a:nth-of-type(1):focus{
    color: #ffffff;
    background: #0A6CC8
}
</style>
```

```{=html}
<style>
.math {
  font-size: 15px;
  color: #B6854D;
}
</style>
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, cache = TRUE, 
                      cache.lazy = FALSE, class.source = "fold-show")
knitr::opts_knit$set(root.dir = here::here())
setwd(here::here())
```

```{r,echo=FALSE, eval=FALSE}
rm(list = ls())
```

```{r, echo = FALSE, results=FALSE}
# Paquetes que se usaron en el documento 
require(dplyr)          #A Grammar of Data Manipulation 
require(ggplot2)        # Generar gráficos ggplot y la geometría de un mapa
require(RColorBrewer)
require(ggspatial)
require(ggpubr)
require(knitr)
require(kableExtra)
require(openxlsx)
require(readxl)
require(rgdal)          #Para importar shapefiles. 
require(sp)             # Classes and Methos for Spatial Data
library(spdep)    # Índice de Moran 
require(spdplyr)        #Data manipulation verbs for the sptial classes
require(stringr)
require(tidyverse) 
require(unikn)          # Paleta de colores
```

```{r, echo = FALSE, results=FALSE}
# Se descargan las fuentes de la google fonts
require(showtext)
# activar showtext
showtext_auto()
font_add_google("Montserrat", "montserrat")
```

## Objetivo 

## Secretariado Ejecutivo del Sistema Nacional de Seguridad Pública (`SESNSP`)   

El Secretariado Ejecutivo del Sistema Nacional de Seguridad Pública (`SESNSP`) es una institución clave en México, encargada de coordinar y ejecutar las políticas públicas en materia de seguridad pública. Su objetivo principal es fortalecer la seguridad en todo el país, trabajando en colaboración con los tres niveles de gobierno (federal, estatal y municipal).

Las funciones más importantes del `SESNSP`:

* **Coordinación y seguimiento:**
    * El SESNSP actúa como eje de coordinación entre las diversas instituciones de seguridad pública, tanto a nivel federal como estatal y municipal.
    * Da seguimiento a los acuerdos y decisiones del Consejo Nacional de Seguridad Pública.
* **Implementación de políticas públicas:**
    * Se encarga de diseñar e implementar estrategias y programas para prevenir el delito, fortalecer las instituciones de seguridad y mejorar la respuesta ante situaciones de emergencia.
* **Profesionalización y equipamiento:**
    * Promueve la capacitación y profesionalización de los cuerpos de seguridad.
    * Impulsa la modernización del equipamiento tecnológico e infraestructura de las instituciones de seguridad.
* **Información y datos:**
    * Genera y difunde información estadística sobre incidencia delictiva y otros indicadores relevantes para la seguridad pública.
    * Proporciona datos para la toma de decisiones en materia de seguridad.
* **Prevención del delito:**
    * Promueve la cultura de la paz y la legalidad.
    * Desarrolla programas para la prevención social de la violencia y la delincuencia.
* **Participación ciudadana:**
    * Fomenta la colaboración entre la ciudadanía y las autoridades en materia de seguridad.


### Fuentes de información    

El Secretariado Ejecutivo del Sistema Nacional de Seguridad Pública (SESNSP) recopila y publica información sobre incidencia delictiva a través de un proceso sistemático y riguroso que involucra a diversas fuentes oficiales y metodologías estadísticas estandarizadas. Esta institución gubernamental se encarga de centralizar, procesar y difundir los datos relacionados con la seguridad pública en todo el territorio mexicano, proporcionando así una visión integral de la situación delictiva en el país. Aquí te explico detalladamente cómo llevan a cabo este importante proceso de recolección y publicación de información:

- **Fiscalías y Procuradurías:**
    - Las fiscalías generales de los estados y la Fiscalía General de la República (FGR) proporcionan los datos detallados y sistemáticos sobre los delitos registrados en sus investigaciones, constituyendo una de las principales fuentes de información estadística a nivel nacional.
    - Esta información abarca tanto las averiguaciones previas del sistema tradicional como las carpetas de investigación iniciadas bajo el nuevo sistema de justicia penal acusatorio, lo que permite una visión completa del panorama delictivo documentado oficialmente.
- **Registros administrativos:**
    - El SESNSP también utiliza y analiza datos provenientes de diversos registros administrativos de otras instituciones gubernamentales, como las corporaciones policiales estatales y municipales, así como los centros de atención de llamadas de emergencia (911), que complementan la información obtenida de las fiscalías para ofrecer un panorama más integral de la situación delictiva. 
    
    
### Metodología:   

- **Registro de delitos:**
    - La incidencia delictiva se refiere específicamente a la presunta ocurrencia de delitos formalmente registrados en las investigaciones oficiales, siguiendo protocolos estandarizados que permiten la comparabilidad de los datos a nivel nacional e internacional.
    - El SESNSP clasifica meticulosamente los delitos en diferentes categorías y subcategorías, tanto del fuero común como del fuero federal, utilizando criterios uniformes que facilitan el análisis estadístico y la identificación de patrones delictivos en diferentes regiones del país. 
    
    
- **Publicación de datos:**
    - El SESNSP publica periódicamente los datos compilados de incidencia delictiva en su sitio web oficial, a través de informes mensuales detallados y compendios anuales que permiten visualizar tendencias y comportamientos delictivos a lo largo del tiempo.
    - También proporciona acceso a bases de datos abiertos en formatos compatibles con diferentes programas estadísticos para que la ciudadanía, investigadores, organizaciones civiles y otras instituciones gubernamentales puedan acceder, descargar y analizar la información de acuerdo con sus necesidades específicas.
    - En su página oficial se pueden encontrar los datos desagregados por estado, municipio y región geográfica, y también se puede consultar información especializada sobre delitos federales y comunes, incluyendo variables como modalidad, tipo de delito, bienes jurídicos afectados y características demográficas generales. 
    
### Tipos de delitos 

La diferencia fundamental está en el bien jurídico protegido: en el fuero común, se protege a los ciudadanos individualmente, salvaguardando sus derechos personales y patrimoniales dentro del ámbito local; en el fuero federal, se protege a la nación como entidad soberana, incluyendo sus instituciones, la seguridad nacional y el orden constitucional.   

Algunos delitos pueden ser del fuero común o federal dependiendo de las circunstancias específicas del caso, como la participación de funcionarios federales, el lugar donde se comete el delito (si ocurre en instalaciones federales), la naturaleza transnacional del mismo, o si afecta bienes o recursos que son propiedad o están bajo administración federal.   

**Delitos del Fuero Común:**: Son aquellos que afectan directamente a los ciudadanos en su vida cotidiana. Están tipificados en los códigos penales de cada estado.   

- **Ejemplos**:
    - Robo (a casa habitación, a transeúntes, de vehículos)
    - Homicidio
    - Lesiones
    - Violencia familiar
    - Delitos sexuales
- **Jurisdicción**: Son investigados y juzgados por las autoridades de los estados.

**Delitos del Fuero Federal:**: Son aquellos que afectan a la Federación, es decir, a la nación en su conjunto. Están tipificados en el Código Penal Federal y otras leyes federales.  

- **Ejemplos**:
    - Delitos contra la salud (narcotráfico)
    - Delitos fiscales (evasión de impuestos)
    - Delitos electorales
    - Delitos contra la seguridad de la nación (terrorismo)
    - Delitos cometidos en instalaciones federales.
    - Delitos que involucran a funcionarios federales.    
    
**Jurisdicción**: Son investigados y juzgados por las autoridades federales (Fiscalía General de la República).


```{r, eval = FALSE}
df <- read.csv(file = paste0(here::here(), "/Bases/Municipal-Delitos-2015-2025_ene2025.csv"), 
               header = TRUE,
               encoding = "latin1") %>% 
       rename("CVE_ENT" = "Clave_Ent",
              "CVE_MUN" = "Cve..Municipio") %>%
       mutate(CVE_ENT = str_pad(.$CVE_ENT, width = 2, side = "left", pad = "0"),
              CVE_MUN = str_pad(.$CVE_MUN, width = 5, side = "left", pad = "0"))

```

```{r, echo = FALSE}
#save(df, file = paste0(here::here(), "/Bases/Municipal-Delitos-2015-2025_ene2025.RData"))
load(file = paste0(here::here(), "/Bases/Municipal-Delitos-2015-2025_ene2025.RData"))
```

```{r, echo = FALSE}
require(gt)

head(df, 10) %>% 
 gt() %>%
  tab_header(title = "Reportes de incidencia delictiva a nivel municipal",
             subtitle = "Secretariado Ejecutivo del Sistema Nacional de Seguridad Pública") %>%
   tab_footnote(footnote = "Secretariado Ejecutivo del Sistema Nacional de Seguridad Pública | 20 de febrero de 2025") %>%
   tab_options(heading.title.font.size = 14, 
               heading.subtitle.font.size = 12,
               table.font.names = "Century Gothic",
               table.font.size = 10,
               table.align = 'center',
               data_row.padding = px(1)) %>%
    tab_style(style = list(cell_text(align = "left", 
                                     weight = 'bold')),
               locations = list(cells_title(groups = c("title")))) %>%
     tab_style(style = list(cell_text(align = "left")),
               locations = list(cells_title(groups = c("subtitle")))) %>%
       cols_width(starts_with("Bien.jurídico.afectado") ~ px(180),
                  starts_with("Modalidad") ~ px(180),
                  everything() ~ px(100)) %>%
          as_raw_html()
```


```{r}

```

